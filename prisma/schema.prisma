generator client {
  provider = "prisma-client-js"
}


datasource db {
  provider = "postgresql"
}

model avisos_legales {
  id         Int       @id @default(autoincrement())
  tipo       String    @db.VarChar(50)
  titulo     String?   @db.VarChar(200)
  mensaje    String
  activo     Boolean?  @default(true)
  posicion   String?   @default("antes_diagnostico") @db.VarChar(50)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
}

model consultas {
  id                       Int                        @id @default(autoincrement())
  usuario_id               Int
  sintomas_inicial         String
  diagnostico_final        String?
  gravedad                 String?                    @db.VarChar(20)
  articulos_json           Json?
  estado                   String?                    @default("abierta") @db.VarChar(20)
  created_at               DateTime?                  @default(now()) @db.Timestamp(6)
  updated_at               DateTime?                  @default(now()) @db.Timestamp(6)
  usuarios                 usuarios                   @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  diagnosticos_probables   diagnosticos_probables[]
  historial_conversaciones historial_conversaciones[]

  @@index([gravedad], map: "idx_consultas_gravedad")
  @@index([usuario_id], map: "idx_consultas_usuario")
}

model diagnosticos_probables {
  id              Int       @id @default(autoincrement())
  consulta_id     Int
  enfermedad      String    @db.VarChar(200)
  probabilidad    Decimal?  @db.Decimal(5, 2)
  descripcion     String?
  recomendaciones String?
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  consultas       consultas @relation(fields: [consulta_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([consulta_id], map: "idx_diagnosticos_consulta")
}

model historial_conversaciones {
  id          Int       @id @default(autoincrement())
  consulta_id Int
  rol         String    @db.VarChar(20)
  mensaje     String
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  consultas   consultas @relation(fields: [consulta_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([consulta_id], map: "idx_historial_consulta")
}

model logs_sistema {
  id         Int       @id @default(autoincrement())
  usuario_id Int?
  accion     String    @db.VarChar(100)
  detalles   String?
  ip_address String?   @db.VarChar(45)
  tipo       String?   @default("info") @db.VarChar(50)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  usuarios   usuarios? @relation(fields: [usuario_id], references: [id], onUpdate: NoAction)

  @@index([usuario_id], map: "idx_logs_usuario")
}

model metricas_modelo {
  id                 Int       @id @default(autoincrement())
  fecha              DateTime  @unique @db.Date
  precision          Decimal?  @db.Decimal(5, 2)
  total_evaluaciones Int?      @default(0)
  casos_graves       Int?      @default(0)
  created_at         DateTime? @default(now()) @db.Timestamp(6)
}

model personas {
  id               Int       @id @default(autoincrement())
  nombres          String    @db.VarChar(100)
  apellido_paterno String    @db.VarChar(100)
  apellido_materno String?   @db.VarChar(100)
  telefono         String?   @db.VarChar(20)
  fecha_nacimiento DateTime? @db.Date
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  usuarios         usuarios?
}

model usuarios {
  id           Int            @id @default(autoincrement())
  persona_id   Int            @unique
  email        String         @unique @db.VarChar(100)
  password     String         @db.VarChar(255)
  rol          String?        @default("cliente") @db.VarChar(20)
  activo       Boolean?       @default(true)
  created_at   DateTime?      @default(now()) @db.Timestamp(6)
  consultas    consultas[]
  logs_sistema logs_sistema[]
  personas     personas       @relation(fields: [persona_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([email], map: "idx_usuarios_email")
  @@index([persona_id], map: "idx_usuarios_persona")
}
